## Objetivo
El objetivo de este laboratorio es aprender a utilizar la herramienta Wireshark para capturar y analizar el tráfico de red entre diferentes servicios y dispositivos. Wireshark es un analizador de protocolos de red que permite ver el contenido y las características de los paquetes que circulan por una red. Esto es útil para comprender el funcionamiento de los protocolos de red, detectar problemas de comunicación, identificar anomalías y ataques, y realizar auditorías de seguridad.

## Pasos
1. Descargar e instalar la herramienta Wireshark en el equipo local. Se puede obtener desde aquí.
2. Descargar el archivo `docker-compose.yml` que contiene la configuración de los servicios y dispositivos que se van a utilizar en el laboratorio. Se puede obtener desde aquí.
3. Ejecutar el comando `docker-compose up -d` para levantar los servicios y dispositivos. Estos son:
   1. Un servidor web que ofrece una página HTML con un formulario de inicio de sesión. El servidor web está expuesto en el puerto 80 y tiene la dirección IP 172.20.0.2.
   2. Un servidor de base de datos que almacena las credenciales de los usuarios del servidor web. El servidor de base de datos está expuesto en el puerto 3306 y tiene la dirección IP 172.20.0.3.
   3. Un cliente web que accede al servidor web desde un navegador. El cliente web tiene la dirección IP 172.20.0.4.
   4. Un atacante que intenta interceptar y modificar el tráfico de red entre el cliente web y el servidor web. El atacante tiene la dirección IP 172.20.0.5.
4. Abrir la herramienta Wireshark y seleccionar la interfaz de red que corresponde a la red creada por docker-compose. Esta interfaz se llama docker0 y tiene la dirección `IP 172.20.0.1`.
5. Iniciar la captura de paquetes haciendo clic en el botón verde de la barra de herramientas. Se verá una lista de paquetes que van apareciendo en tiempo real, con información sobre el número, el tiempo, la fuente, el destino, el protocolo, la longitud y la información del paquete.
6.  En el cliente web, abrir el navegador y acceder a la dirección `http://172.20.0.2`. Se verá una página con un formulario de inicio de sesión que pide un nombre de usuario y una contraseña.
7.  En el servidor web, abrir una terminal y ejecutar el comando `tcpdump -i eth0 -w server.pcap` para guardar el tráfico de red que llega al servidor web en un archivo llamado server.pcap.
8.  En el atacante, abrir una terminal y ejecutar el comando `arpspoof -i eth0 -t 172.20.0.4 172.20.0.2` para realizar un ataque de ARP spoofing que engaña al cliente web para que envíe el tráfico destinado al servidor web al atacante en lugar de al servidor web. Este ataque se basa en enviar mensajes ARP falsos que indican que la dirección MAC del servidor web es la misma que la del atacante.
9.  En el cliente web, introducir un nombre de usuario y una contraseña arbitrarios en el formulario de inicio de sesión y hacer clic en el botón de enviar. Se verá un mensaje de error que indica que las credenciales son incorrectas.
10. En el atacante, abrir otra terminal y ejecutar el comando `tcpdump -i eth0 -w attacker.pcap` para guardar el tráfico de red que llega al atacante en un archivo llamado attacker.pcap.
11. En el servidor web, detener el comando tcpdump con Ctrl+C y copiar el archivo `server.pcap` al equipo local con el comando `docker cp web:server.pcap ..`
12. En el atacante, detener los comandos arpspoof y tcpdump con Ctrl+C y copiar el archivo attacker.pcap al equipo local con el comando docker cp attacker:attacker.pcap ..
13. Detener los servicios y dispositivos con el comando docker-compose down.
14. Abrir los archivos server.pcap y attacker.pcap con la herramienta Wireshark y analizar el contenido de los paquetes capturados.

## Resultados esperados
Al analizar el contenido de los paquetes capturados, se espera que los estudiantes puedan observar y explicar lo siguiente:

- La diferencia entre el tráfico de red que llega al servidor web y al atacante. El servidor web solo recibe los paquetes que le envía el atacante, mientras que el atacante recibe los paquetes que le envía el cliente web y los que le envía el servidor web.
- La forma en que el atacante realiza el ataque de ARP spoofing. El atacante envía mensajes ARP falsos que indican que la dirección MAC del servidor web es la misma que la del atacante, lo que hace que el cliente web actualice su tabla ARP y envíe el tráfico destinado al servidor web al atacante. El atacante también envía mensajes ARP falsos que indican que la dirección MAC del cliente web es la misma que la del atacante, lo que hace que el servidor web actualice su tabla ARP y envíe el tráfico destinado al cliente web al atacante. De esta forma, el atacante se sitúa en el medio de la comunicación entre el cliente web y el servidor web, y puede ver y modificar el tráfico que pasa por él.
- La información que el atacante puede obtener del tráfico de red. El atacante puede obtener información como el nombre de usuario y la contraseña que introduce el cliente web en el formulario de inicio de sesión, el contenido de la página web que le envía el servidor web al cliente web, y los datos de la base de datos que le envía el servidor web al cliente web. El atacante puede obtener esta información porque el tráfico de red no está cifrado ni protegido, y se utiliza el protocolo HTTP, que es un protocolo de texto plano que se puede leer fácilmente.
- La forma en que el atacante puede modificar el tráfico de red. El atacante puede modificar el tráfico de red utilizando herramientas como ettercap, que le permiten interceptar y alterar los paquetes que pasan por él. Por ejemplo, el atacante puede modificar el contenido de la página web que le envía el servidor web al cliente web, cambiando el texto, las imágenes, los enlaces, etc. El atacante también puede modificar los datos de la base de datos que le envía el servidor web al cliente web, insertando, borrando o modificando registros, etc. El atacante puede hacer esto porque el tráfico de red no está autenticado ni verificado, y se utiliza el protocolo HTTP, que es un protocolo que no tiene mecanismos de integridad ni de validación.
- Las medidas que se podrían tomar para evitar o mitigar el ataque de *ARP spoofing*. Algunas medidas que se podrían tomar son las siguientes:
- Utilizar protocolos de red seguros, como **HTTPS**, que cifran y protegen el tráfico de red, evitando que el atacante pueda ver o modificar el contenido de los paquetes.
- Utilizar mecanismos de autenticación y control de acceso, como certificados digitales, que verifican la identidad de los dispositivos y los servicios, evitando que el atacante pueda suplantarlos o acceder a ellos.
- Utilizar herramientas de detección y prevención de intrusiones, como IDS e IPS, que monitorean el tráfico de red y alertan o bloquean las actividades sospechosas o maliciosas, evitando que el atacante pueda realizar el ataque o causar daños.
- Utilizar técnicas de defensa en profundidad, como segmentación de red, aislamiento de servicios y dispositivos, y aplicación de políticas de seguridad, que limitan el alcance y el impacto del ataque, evitando que el atacante pueda acceder o afectar a otros recursos o servicios de la red.